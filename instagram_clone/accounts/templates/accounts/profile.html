{% extends "base.html" %}

{% block content %}
<style>
    /* 최희정 수정 */
.modal_overlay {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(1.5px);
    -webkit-backdrop-filter: blur(1.5px);
}

.modal_window {
    background: white;
    backdrop-filter: blur(13.5px);
    -webkit-backdrop-filter: blur(13.5px);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    width: 400px;
    height: 500px;
    position: relative;
    padding: 10px;
}

.modal_title{
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-weight: bold;
    font-size: 20px;
}

.modal_content{
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-size: 16px;
}

.modal_title_side{
    {% comment %} flex: 0 0 40px; {% endcomment %}
    text-align: center;
    }
</style>

<h3> {{ request.user }} 프로필 페이지</h3>

<h3>자기소개 : {{ user.introduce }} </h3>

{% if user.gender == 'F' %}
<h3>성별 : 여자 </h3>
{% elif user.gentder == 'M' %}
<h3>성별 : 남자 </h3>
{% else %}
<h3>성별 : 선택안함 </h3>
{% endif %}




<!-- add_box id 속성 추가 -->
<span id="add_feed" class="material-icons-outlined">사진 변경</span>

<!-- model id 속성 추가 -->
<!-- create feed -->
<div id="modal_add_feed" class="modal_overlay" style='display:none'> 
    <div class="modal_window">
        <div class="modal_title">
        <div> 프로필 사진 바꾸기 </div>
        <div class="modal_content">
            <div> 사진 업로드 </div>
                <form method="post" action="{% url "accounts:upload_img" %}" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="profile_img">
                <button type="submit" value='사진올리기'>Upload</button>
                </form>


            <div> 현재 사진 삭제 </div>
                <span id="close_modal" class="material-icons-outlined">
                    취소
                </span>
        </div>
        </div>
    </div>
</div>



{% endblock content %}

{% block script %}
{% comment %} {% load static %}
<script src="{% static 'js/accounts/profile.js' %}"></script> {% endcomment %}

<script>
// 모달 창 띄우기
const modal = document.getElementById("modal_add_feed");
const buttonAddFeed = document.getElementById("add_feed");
buttonAddFeed.addEventListener("click", e => {
    console.log('click');
    modal.style.display = "flex";
    document.body.style.overflowY = "hidden"; // 스크롤 없애기
});


// 모달 닫기 코드
const buttonCloseModal = document.getElementById("close_modal");
buttonCloseModal.addEventListener("click", e => {
    modal.style.display = "none";
    document.body.style.overflowY = "visible";
});

<!-- jquery 부분 -->

    $('.modal_image_upload')
        .on("dragover", dragOver)
        .on("dragleave", dragOver)
        .on("drop", uploadFiles);

    function dragOver(e){
        e.stopPropagation();
        e.preventDefault();
        
        if (e.type == "dragover") {
            $(e.target).css({
                "background-color": "black",
                "outline-offset": "-20px"
            });
        } else {
            $(e.target).css({
                "background-color": "white",
                "outline-offset": "-10px"
            });
        }
    }

    function uploadFiles(e){
        e.stopPropagation();
        e.preventDefault();
        
        e.dataTransfer = e.originalEvent.dataTransfer; 
        var files =  e.dataTransfer.files;

        if (files.length > 1) {
            alert('하나만 올려라.');
            return;
        }

        if (files[0].type.match(/image.*/)) {
            $(e.target).css({
                "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                "outline": "none",
                "background-size": "100% 100%"});
        }else{
            alert('이미지가 아닙니다.');
            return;
        }

    }
</script>
{% endblock script %}

